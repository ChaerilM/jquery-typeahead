/* stylelint-disable no-descending-specificity */
/* stylelint-disable selector-class-pattern */
@use 'sass:color';
@import 'variables';
@import 'reset';

// TYPEAHEAD -----------------------------------------------------------------------------------------------------------

.typeahead {
  &__container {
    position: relative;
    font: $typeahead-font-size $typeahead-font-family;

    * {
      box-sizing: border-box;
      outline: 0;
    }

    input.disabled,
    input[disabled],
    button.disabled,
    button[disabled] {
      cursor: not-allowed;
      pointer-events: none;
      opacity: 0.65;
      box-shadow: none;
      background-color: #fff;
      border-color: $typeahead-border-color;
    }

    .typeahead__field {
      input,
      textarea,
      [contenteditable],
      .typeahead__hint,
      .typeahead__label-container {
        padding-right: 32px;
      }
    }

    &.result .typeahead__list,
    &.filter .typeahead__dropdown,
    &.hint .typeahead__hint,
    &.backdrop+.typeahead__backdrop {
      display: block !important;
    }

    .typeahead__list,
    .typeahead__dropdown,
    .typeahead__hint,
    +.typeahead__backdrop {
      display: none !important;
    }

  }

  &__query,
  &__filter,
  &__field,
  &__button,
  &__list,
  &__dropdown,
  &__result,
  &__hint,
  &__label-container,
  &__label,
  &__cancel-button,
  &__search-icon {
    position: relative;
  }

  &__query {
    z-index: 2;
    width: 100%;
  }

  &__filter {
    button {
      min-width: 100%;
      white-space: nowrap;

      &::after {
        display: inline-block;
        margin-left: 4px;
        width: 0;
        height: 0;
        vertical-align: -2px;
        content: "";
        border: 4px solid;
        border-right-color: transparent;
        border-bottom-color: transparent;
        border-left-color: transparent;
      }
    }
  }


  &__field {
    display: flex;
    width: 100%;

    // #193 If applied to input, it overrides the placeholder color on IE10/11
    color: $typeahead-color;

    input,
    textarea,
    [contenteditable],
    .typeahead__hint {
        display: block;
        width: 100%;
        line-height: $typeahead-line-height;
        min-height: calc(#{$typeahead-padding-y} * 2 + 1.25rem + 2px);
        padding: $typeahead-padding-y $typeahead-padding-x;
        background: #fff;
        border: 1px solid $typeahead-border-color;
        border-radius: $typeahead-radius 0 0 $typeahead-radius;
        appearance: none;
        box-sizing: border-box;

        @if $typeahead-shadow {
          box-shadow: inset 0 1px 1px rgb(0 0 0 / 7.5%);
        }

        &:focus,
        &:active {
          border-color: $typeahead-outline-color;
        }

    }
  }

  &__button button {
    border-top-right-radius: $typeahead-radius;
    border-bottom-right-radius: $typeahead-radius;
  }

  &__list {
    >.typeahead {
      &__group {
        border-color: $typeahead-group-border-color;
        font-weight: bold;

        &:first-child {
          @if $typeahead-dropdown-spacing > 0 {
            border-top: solid 1px $typeahead-group-border-color;
          }
        }

        >a,
        >a:hover,
        >a:focus,
        &.active>a {
          cursor: default;
          color: $typeahead-group-color;
          background: $typeahead-group-background;
          display: block;
          padding: $typeahead-padding-y $typeahead-padding-x;
          clear: both;
          text-decoration: none;
        }
      }
    }
  }

  &__list,
  &__dropdown {
    position: absolute;
    left: 0;
    z-index: 1000;
    width: 100%;
    min-width: 160px;
    padding: $typeahead-dropdown-spacing 0;
    margin: 2px 0 0;
    list-style: none;
    text-align: left;
    background-color: #fff;
    border: 1px solid $typeahead-border-color;
    border-radius: $typeahead-radius;
    background-clip: padding-box;

    @if $typeahead-shadow {
      box-shadow: 0 6px 12px rgb(0 0 0 / 17.5%);
    }

    .typeahead {
      &__item,
      &__dropdown-item {
        >a {
          display: block;
          padding: $typeahead-padding-y $typeahead-padding-x;
          clear: both;
          color: $typeahead-item-color;
          text-decoration: none;
        }

        &[disabled] {
          >a {
            cursor: not-allowed;
            color: $typeahead-item-disabled-color;
            background-color: $typeahead-item-disabled-background;
          }
        }

        &:not([disabled]) {
          >a:hover,
          >a:focus,
          &.active>a {
            background-color: $typeahead-item-hover-background;
            color: color.adjust($typeahead-color, $lightness: -10%);
          }
        }
      }
    }
  }

  &__cancel-button {
    user-select: none;
    position: absolute;
    right: 0;
    cursor: pointer;
    line-height: 1.25;
    padding: $typeahead-padding-y $typeahead-padding-x;
    visibility: hidden;
  }

  &__search-icon {
    padding: 0 1.25rem;
    width: 16px;
    height: 16px;

    // Reference: http://www.flaticon.com/free-icon/musica-searcher_70376
    background: url("data:image/svg+xml;charset=utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMS4xLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDI1MC4zMTMgMjUwLjMxMyIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjUwLjMxMyAyNTAuMzEzOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCI+CjxnIGlkPSJTZWFyY2giPgoJPHBhdGggc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkOyIgZD0iTTI0NC4xODYsMjE0LjYwNGwtNTQuMzc5LTU0LjM3OGMtMC4yODktMC4yODktMC42MjgtMC40OTEtMC45My0wLjc2ICAgYzEwLjctMTYuMjMxLDE2Ljk0NS0zNS42NiwxNi45NDUtNTYuNTU0QzIwNS44MjIsNDYuMDc1LDE1OS43NDcsMCwxMDIuOTExLDBTMCw0Ni4wNzUsMCwxMDIuOTExICAgYzAsNTYuODM1LDQ2LjA3NCwxMDIuOTExLDEwMi45MSwxMDIuOTExYzIwLjg5NSwwLDQwLjMyMy02LjI0NSw1Ni41NTQtMTYuOTQ1YzAuMjY5LDAuMzAxLDAuNDcsMC42NCwwLjc1OSwwLjkyOWw1NC4zOCw1NC4zOCAgIGM4LjE2OSw4LjE2OCwyMS40MTMsOC4xNjgsMjkuNTgzLDBDMjUyLjM1NCwyMzYuMDE3LDI1Mi4zNTQsMjIyLjc3MywyNDQuMTg2LDIxNC42MDR6IE0xMDIuOTExLDE3MC4xNDYgICBjLTM3LjEzNCwwLTY3LjIzNi0zMC4xMDItNjcuMjM2LTY3LjIzNWMwLTM3LjEzNCwzMC4xMDMtNjcuMjM2LDY3LjIzNi02Ny4yMzZjMzcuMTMyLDAsNjcuMjM1LDMwLjEwMyw2Ny4yMzUsNjcuMjM2ICAgQzE3MC4xNDYsMTQwLjA0NCwxNDAuMDQzLDE3MC4xNDYsMTAyLjkxMSwxNzAuMTQ2eiIgZmlsbD0iIzU1NTU1NSIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=") no-repeat scroll center center transparent;
  }

  &__label-container {
    list-style: none;
    position: absolute;
    padding-top: calc(#{$typeahead-font-size} * 0.375);
    padding-left: 6px;
    width: 100%;
    flex-wrap: wrap;
    display: flex;
  }

  &__label {
    visibility: visible;
    right: 4px;
    display: flex;
    font-size: $typeahead-label-font-size;
    position: relative;
    background: $typeahead-label-background;
    border: solid 1px $typeahead-label-border-color;
    padding-left: 4px;
    border-radius: $typeahead-radius;
    margin-right: 4px;
    margin-bottom: calc(#{$typeahead-font-size} * 0.375);

    >* {
      align-self: center;
    }

    .typeahead {
      &__cancel-button {
        line-height: normal;
        height: auto;
        position: static;
        padding: calc(#{$typeahead-font-size} * 0.25 - 1px) 6px calc(#{$typeahead-font-size} * 0.25 + 1px) 6px;
        margin-left: 4px;
        font-size: $typeahead-label-font-size;
        border-left: solid 1px $typeahead-label-border-color;

        &:hover {
          background-color: color.adjust($typeahead-label-background, $lightness: -5%);
        }
      }
    }
  }

  // --------------------------


  &__container.hint .typeahead__field {
    input,
    textarea,
    [contenteditable] {
      background: transparent;
    }
  }

  &__container.hint .typeahead__query> :last-child,
  &__hint {
    background: #fff;
  }

  &__container button {
    display: inline-block;
    margin-bottom: 0;
    text-align: center;
    touch-action: manipulation;
    cursor: pointer;
    background-color: #fff;
    border: 1px solid $typeahead-border-color;
    line-height: $typeahead-line-height;
    padding: $typeahead-padding-y $typeahead-padding-x;
    user-select: none;
    color: $typeahead-color;

    @if $typeahead-shadow {
      box-shadow: inset 0 -2px 0 rgb(0 0 0 / 5%);
    }

    &:hover,
    &:focus {
      color: color.adjust($typeahead-color, $lightness: -10%);
      background-color: $typeahead-item-hover-background;
      border-color: color.adjust($typeahead-border-color, $lightness: -10%);
    }

    &:active,
    &.active {
      background-image: none;

      @if $typeahead-shadow {
        box-shadow: inset 0 3px 5px rgb(0 0 0 / 12.5%);
      }
    }

    &:focus,
    &:active {
      border-color: $typeahead-outline-color;
    }
  }

  &__filter,
  &__button {
    z-index: 1;

    button {
      margin-left: -1px;
      border-bottom-left-radius: 0;
      border-top-left-radius: 0;
    }

    &:hover,
    &:active,
    &:focus {
      z-index: 1001;

      button {
        &:focus,
        &:active {
          z-index: 1001;
        }
      }
    }
  }

  &__filter+&__button {
    button {
      margin-left: -2px;
    }
  }

  &__container.filter .typeahead__filter {
    z-index: 1001;
  }

  &__result.detached .typeahead__list {
    position: relative;
    z-index: 1041;
    top: initial;
    left: initial;
  }

  &__dropdown {
    right: 0;
    left: initial;
    z-index: 1001;
  }

  &__list>li {
    position: relative;
    border-top: solid 1px $typeahead-border-color;

    &:first-child {
      border-top: none;
    }
  }

  &__list.empty {
    >li {
      padding: $typeahead-padding-y $typeahead-padding-x;
      color: $typeahead-item-color;
    }
  }

  &__list> {
    li.typeahead__group+li.typeahead__item {
      border-color: $typeahead-group-border-color;
    }
  }

  &__dropdown li:last-child {
    margin-top: $typeahead-dropdown-spacing;
    padding-top: $typeahead-dropdown-spacing;
    border-top: solid 1px $typeahead-border-color;
  }

  &__container.cancel:not(.loading),
  &__label {
    .typeahead__cancel-button {
      visibility: visible;

      &:hover {
        color: $typeahead-cancel-color;
      }
    }
  }

  &__container.loading .typeahead__query {
    &::before,
    &::after {
      transition: all 0s linear, opacity 0.2s ease;
      position: absolute;
      z-index: 3;
      content: "";
      top: 50%;
      right: 0.55em;
      margin-top: calc($typeahead-loading-size / -2);
      width: $typeahead-loading-size;
      height: $typeahead-loading-size;
      box-sizing: border-box;
      border-radius: 500rem;
      border-style: solid;
      border-width: 0.1em;
    }

    &::before {
      border-color: rgb(0 0 0 / 35%);
    }

    &::after {
      animation: button-spin 0.6s linear;
      animation-iteration-count: infinite;
      border-color: #fff transparent transparent;
      box-shadow: 0 0 0 1px transparent;
    }

    @keyframes button-spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }
  }

}
